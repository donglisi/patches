From 890f391460692e831e00024e2be02b0a0b91e761 Mon Sep 17 00:00:00 2001
From: Dongli Si <sidongli1997@gmail.com>
Date: Sat, 13 Apr 2024 06:46:06 +0800
Subject: [PATCH 1/3] Support x86 architecture virtio over mmio

Signed-off-by: Dongli Si <sidongli1997@gmail.com>
---
 builtin-run.c | 4 +++-
 virtio/core.c | 4 ++--
 2 files changed, 5 insertions(+), 3 deletions(-)

diff --git a/builtin-run.c b/builtin-run.c
index c26184e..c2723b3 100644
--- a/builtin-run.c
+++ b/builtin-run.c
@@ -182,11 +182,13 @@ static int loglevel_parser(const struct option *opt, const char *arg, int unset)
 	" in megabytes (M)"
 #endif
 
-#if defined(CONFIG_ARM) || defined(CONFIG_ARM64) || defined(CONFIG_RISCV)
+// #if defined(CONFIG_ARM) || defined(CONFIG_ARM64) || defined(CONFIG_RISCV)
 #define VIRTIO_TRANS_OPT_HELP_SHORT    "[pci|pci-legacy|mmio|mmio-legacy]"
+/*
 #else
 #define VIRTIO_TRANS_OPT_HELP_SHORT    "[pci|pci-legacy]"
 #endif
+*/
 
 #define BUILD_OPTIONS(name, cfg, kvm)					\
 	struct option name[] = {					\
diff --git a/virtio/core.c b/virtio/core.c
index b77e987..37d02a6 100644
--- a/virtio/core.c
+++ b/virtio/core.c
@@ -31,12 +31,12 @@ int virtio_transport_parser(const struct option *opt, const char *arg, int unset
 			*type = VIRTIO_PCI;
 		} else if (!strcmp(arg, "pci-legacy")) {
 			*type = VIRTIO_PCI_LEGACY;
-#if defined(CONFIG_ARM) || defined(CONFIG_ARM64) || defined(CONFIG_RISCV)
+// #if defined(CONFIG_ARM) || defined(CONFIG_ARM64) || defined(CONFIG_RISCV)
 		} else if (!strcmp(arg, "mmio")) {
 			*type = VIRTIO_MMIO;
 		} else if (!strcmp(arg, "mmio-legacy")) {
 			*type = VIRTIO_MMIO_LEGACY;
-#endif
+// #endif
 		} else {
 			pr_err("virtio-transport: unknown type \"%s\"\n", arg);
 			return -1;
-- 
2.41.0
